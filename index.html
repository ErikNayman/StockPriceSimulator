<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AAPL Sensitivity Simulator</title>
  <script src="https://cdn.plot.ly/plotly-2.20.0.min.js"></script>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:2rem;background:#f4f6f9;color:#222}
    h1{margin:0 0 1rem;font-size:1.5rem}
    .box{max-width:960px;margin:auto;background:#fff;padding:1.6rem 2rem;border-radius:12px;box-shadow:0 3px 14px rgba(0,0,0,.08)}
    .grid{display:grid;grid-template-columns:180px 1fr;gap:.8rem;margin-bottom:1rem}
    label{font-weight:600;margin-top:.3rem}
    input[type=number]{width:100%;padding:6px;border:1px solid #ccc;border-radius:4px}
    button{padding:9px 18px;background:#2b7cff;color:#fff;border:none;border-radius:6px;font-weight:700;cursor:pointer;font-size:1rem;margin-top:.5rem}
    button:hover{opacity:.93}
    #plot{height:520px;width:100%;}
    .note{font-size:.85rem;color:#555;margin-top:1rem}
  </style>
</head>
<body>
  <div class="box">
    <h1>AAPL Price Sensitivity Simulator</h1>

    <div class="grid">
      <label>iPhone ASP range (%)</label>
      <input id="aspRange" type="number" value="15" step="1" title="Max positive/negative change, e.g. ±15%" />
      <label>Services growth range (%)</label>
      <input id="srvRange" type="number" value="20" step="1" title="Max positive/negative change, e.g. ±20%" />
      <label>Elasticity (volume vs ASP)</label>
      <input id="elas" type="number" value="1.3" step="0.1" title="|dQ/Q| / |dP/P| for iPhone" />
      <label>Margin Δ per 1% ASP</label>
      <input id="mSens" type="number" value="0.1" step="0.05" title="ppt change in net‑margin per +1% ASP" />
      <label>PE Δ per 1% Services</label>
      <input id="peSens" type="number" value="0.5" step="0.1" title="% change in P/E per +1% Services growth" />
    </div>
    <button id="run">Run simulation</button>
    <div id="plot"></div>
    <p class="note">Heat‑map shows modeled share‑price (USD). X – Services growth, Y – ASP shift. Assumes FY‑23 baseline, fixed other segments.</p>
  </div>

<script>
// ---------- baseline FY‑23 numbers (simplified) ----------
const BASE = {
  revenue:{iPhone:169.65,Mac:29.36,iPad:28.30,Wear:39.84,Services:85.20}, // B$
  netIncome:96.99, // B$
  shares:15.813,   // B
  pe:28.0,
  ASP:950         // $ baseline iPhone ASP
};

// helper to compute matrix & plot
function calcAndPlot(){
  const rASP = parseFloat(document.getElementById('aspRange').value)||15;
  const rSrv = parseFloat(document.getElementById('srvRange').value)||20;
  const elasticity = parseFloat(document.getElementById('elas').value)||1.3;
  const mSens = parseFloat(document.getElementById('mSens').value)||0.1;
  const peSens = parseFloat(document.getElementById('peSens').value)||0.5;

  const aspSteps = 13; // -range..+range
  const srvSteps = 13;
  const aspVec = [...Array(aspSteps)].map((_,i)=>-rASP + i*(2*rASP)/(aspSteps-1));
  const srvVec = [...Array(srvSteps)].map((_,i)=>-rSrv + i*(2*rSrv)/(srvSteps-1));

  const priceGrid = aspVec.map(()=>Array(srvSteps).fill(0));

  const {revenue, netIncome, shares, pe, ASP} = BASE;
  const iphoneUnits = revenue.iPhone*1e9 / ASP; // baseline units
  const revOther = revenue.Mac + revenue.iPad + revenue.Wear;
  const margin0 = netIncome / (Object.values(revenue).reduce((a,b)=>a+b,0));

  aspVec.forEach((aspPct, yi)=>{
    srvVec.forEach((srvPct, xi)=>{
      const aspNew = ASP*(1+aspPct/100);
      const vol = iphoneUnits * Math.max(0, 1 - elasticity*aspPct/100);
      const revIphone = aspNew*vol/1e9;
      const revServices = revenue.Services*(1+srvPct/100);
      const revTotal = revIphone + revOther + revServices;
      const margin = Math.max(0.05, margin0 + mSens*(aspPct/100));
      const net = revTotal*margin;
      const eps = (net*1e9)/(shares*1e9);
      const peNew = Math.max(5, pe*(1+peSens*(srvPct/100)));
      const price = eps*peNew;
      priceGrid[yi][xi] = price.toFixed(0);
    });
  });

  // Plotly heat‑map
  const data=[{
    z:priceGrid,
    x:srvVec,
    y:aspVec,
    type:'heatmap',
    colorscale:'Viridis',
    colorbar:{title:'$'}
  }];
  const layout={
    xaxis:{title:'Services growth %'},
    yaxis:{title:'iPhone ASP change %'},
    title:'AAPL price sensitivity surface',
    margin:{t:40}
  };
  Plotly.newPlot('plot',data,layout,{responsive:true});
}

document.getElementById('run').onclick=calcAndPlot;
// initial plot
calcAndPlot();
</script>
</body>
</html>
